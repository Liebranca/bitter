# KVR GNU MAKEFILE

#   ---     ---     ---     ---     ---
# platform switch

ifdef x32
PLAT = x32
PFLG = -m32
else
PLAT = x64
PFLG = -m64
endif

#   ---     ---     ---     ---     ---

AVTO_FILES = $(CURDIR)/AVTOMAT/calout.h

#   ---     ---     ---     ---     ---

.PHONY: kvrnel sin chasm espectro nrun reb clean

$(CURDIR)/AVTO:
	@cd $(CURDIR)/AVTOMAT; python avtomat.py; \
    echo "ES-AVTOMAT: files generated by $(shell hostname) on $(shell date)" \
         > $(CURDIR)/AVTO

kvrnel: $(CURDIR)/AVTO
	@cd $(CURDIR)/KVRNEL; make

sin: kvrnel
	@cd $(CURDIR)/SIN; make

chasm: sin
	@cd $(CURDIR)/CHASM; make

espectro: chasm
	@cd $(CURDIR)/ESPECTRO; make

nrun: espectro
	@clear; ../bin/$(PLAT)/es-shell

rrun:
	@../bin/$(PLAT)/es-shell

clean:
	@echo Cleaning up...
	@echo kvrnel
	@cd $(CURDIR)/KVRNEL; make clean -s;
	@echo sin
	@cd $(CURDIR)/SIN; make clean -s;
	@echo chasm
	@cd $(CURDIR)/CHASM; make clean -s;
	@echo espectro
	@cd $(CURDIR)/ESPECTRO; make clean -s;
	@rm -f $(CURDIR)/AVTO

reb: | clean kvrnel sin chasm espectro

#   ---     ---     ---     ---     ---